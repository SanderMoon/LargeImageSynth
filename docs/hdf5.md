# HDF5 Data Format

This document outlines the structure of the HDF5 file generated by `TiledDummyGen` when using the `--format hdf5` option.

## File Structure

The HDF5 file is organized hierarchically to store subject, sample, and tile-level data efficiently.

```
/
├── sample-index/
│   ├── sample_ids
│   └── sample_paths
└── subjects/
    └── {subject_id}/
        └── {sample_id}/
            ├── hipt_features_comp_1/
            │   ├── features
            │   ├── positions
            │   └── tile_keys
            └── synthetic_text
```

### Top-Level Groups

*   `/sample-index`: An index to quickly access all samples in the dataset.
*   `/subjects`: Contains all the subject data, organized by subject ID.

### Datasets Explained

*   `/sample-index/sample_ids`: A 1D array of all sample IDs in the dataset.
*   `/sample-index/sample_paths`: A 1D array of internal HDF5 paths to each corresponding sample group.
*   `/subjects/{subject_id}/{sample_id}`: A group representing a single sample for a subject.
*   `/subjects/{subject_id}/{sample_id}/hipt_features_comp_1/features`: A 3D array containing the feature embeddings for each tile in the sample.
    *   **Shape**: `(num_tiles, 1, embedding_dimension)`
    *   **Data Type**: `float64`
*   `/subjects/{subject_id}/{sample_id}/hipt_features_comp_1/positions`: A 3D array of the (x, y, z) coordinates for each tile.
    *   **Shape**: `(num_tiles, 1, 3)`
    *   **Data Type**: `int64`
*   `/subjects/{subject_id}/{sample_id}/hipt_features_comp_1/tile_keys`: A 1D array of unique identifiers for each tile.
    *   **Shape**: `(num_tiles,)`
    *   **Data Type**: String
*   `/subjects/{subject_id}/{sample_id}/synthetic_text`: The synthetic text description associated with the sample.
    *   **Data Type**: String

## Accessing Data with Python

You can use the `h5py` library to read and interact with the generated HDF5 file.

### Installation

```bash
pip install h5py
```

### Code Examples

Here are some examples of how to access the data:

#### 1. Open the HDF5 File and List All Samples

```python
import h5py
import numpy as np

def list_all_samples(hdf5_path):
    """
    Opens an HDF5 file and lists all sample IDs.
    """
    with h5py.File(hdf5_path, 'r') as f:
        sample_ids = f['sample-index/sample_ids'][:]
        print(f"Found {len(sample_ids)} samples:")
        for sample_id in sample_ids:
            print(f"  - {sample_id.decode('utf-8')}")

# Example usage:
# list_all_samples('path/to/your/synthetic_dataset.hdf5')
```

#### 2. Access Data for a Specific Sample

```python
import h5py
import numpy as np

def get_sample_data(hdf5_path, sample_id_to_find):
    """
    Retrieves features, positions, and text for a specific sample ID.
    """
    with h5py.File(hdf5_path, 'r') as f:
        # Find the index of the desired sample
        sample_ids = f['sample-index/sample_ids'][:]
        try:
            sample_index = np.where(sample_ids == sample_id_to_find.encode('utf-8'))[0][0]
        except IndexError:
            print(f"Sample ID '{sample_id_to_find}' not found.")
            return

        # Get the path to the sample data
        sample_path = f['sample-index/sample_paths'][sample_index].decode('utf-8')
        
        # Access the data
        sample_group = f[sample_path]
        
        features = sample_group['hipt_features_comp_1/features'][:]
        positions = sample_group['hipt_features_comp_1/positions'][:]
        synthetic_text = sample_group['synthetic_text'][()].decode('utf-8')
        
        print(f"Data for Sample: {sample_id_to_find}")
        print(f"  - Features shape: {features.shape}")
        print(f"  - Positions shape: {positions.shape}")
        print(f"  - Synthetic Text: '{synthetic_text}'")
        
        return features, positions, synthetic_text

# Example usage:
# get_sample_data('path/to/your/synthetic_dataset.hdf5', 'Sample1')
```
