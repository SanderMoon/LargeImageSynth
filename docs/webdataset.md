# WebDataset Data Format

This document outlines the structure of the WebDataset TAR archive generated by `TiledDummyGen` when using the `--format webdataset` option. This format is optimized for sequential access and is commonly used for training deep learning models.

## TAR Archive Structure

The output is a single `.tar` file. Inside this archive, the data is stored as a collection of files associated with each data sample (typically a single tile). For each sample, there are two main files: a PyTorch tensor file for the features and a JSON file for the metadata.

The files are named using a sample key, which is derived from the original data. For a sample with the key `sample_key`, you will find:

*   `sample_key.pth`: A PyTorch tensor file containing the feature embedding for the tile.
*   `sample_key.json`: A JSON file containing metadata associated with the tile.

### File Contents

*   **`.pth` file**:
    *   **Content**: A PyTorch tensor of the feature embedding.
    *   **Data Type**: `torch.Tensor`

*   **`.json` file**:
    *   **Content**: A JSON object with the following keys:
        *   `label`: The label or class of the tile.
        *   `description`: A text description associated with the tile.
        *   `position`: A tuple `[x, y]` representing the tile's coordinates.

## Accessing Data with Python

You can use the `webdataset` library to easily read and process the data from the TAR archive.

### Installation

```bash
pip install webdataset torch
```

### Code Examples

Here is an example of how to iterate through the dataset and access the data for each sample.

#### Iterate Through the Dataset

```python
import webdataset as wds
import torch
import json

def inspect_webdataset(tar_path, num_samples_to_show=5):
    """
    Opens a WebDataset TAR file and inspects a few samples.
    """
    dataset = wds.WebDataset(tar_path)
    
    print(f"Inspecting the first {num_samples_to_show} samples from {tar_path}:")
    
    for i, sample in enumerate(dataset):
        if i >= num_samples_to_show:
            break
            
        print(f"--- Sample {i+1} ---")
        
        # The key for the sample
        sample_key = sample["__key__"]
        print(f"  Key: {sample_key}")
        
        # Access the feature tensor
        feature_tensor = sample["pth"]
        print(f"  Feature Tensor Shape: {feature_tensor.shape}")
        print(f"  Feature Tensor Dtype: {feature_tensor.dtype}")
        
        # Access the metadata
        metadata = sample["json"]
        print(f"  Metadata: {metadata}")
        
# Example usage:
# inspect_webdataset('path/to/your/synthetic_dataset.tar')
```
